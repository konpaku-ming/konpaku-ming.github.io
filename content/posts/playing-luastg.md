---
title: "Playing LuaSTG..."
date: 2026-01-31
draft: false
type: "posts"
description: "My Luastg Trial"
math: true
---

helloï¼Œç±³å¨œæ¡‘~

é¸½çš„è¿™ä¹ˆå¤šå¤©é‡Œï¼Œä¸»è¦æ˜¯æ‘†çƒ‚ + æ‘†å¼„ä¸€äº›ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰æœ‰è¶£çš„ä¸œè¥¿ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ LuaSTG ã€‚æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´è¿™ç©æ„åº”è¯¥æ˜¯å› ä¸ºæŸéƒ¨åŒäººæ¸¸æˆï¼ˆå¤§æ¦‚ç‡æ˜¯ç¥ˆåæ¢¦ï¼‰ï¼Œä¹‹åä¹Ÿç©è¿‡ä¸€äº›ç®—æ˜¯ä¸ªäººåˆ¶ä½œçš„å° Mod ï¼Œä¸è¿‡æˆ‘å½“æ—¶æ²¡æœ‰è€ƒè™‘è¿‡è‡ªå·±åšç‚¹ STG ï¼ŒåŸå› ä¹Ÿå¾ˆç®€å•ï¼šå¤ªèœäº†ã€‚åš STG éœ€è¦æ‡‚å¼¹è®¾ï¼Œæ‡‚å¼¹è®¾ä¸€èˆ¬é£æœºæŠ€æœ¯ä¸ä¼šå¤ªå·®ï¼Œä½†æ˜¯æˆ‘è¿˜å›°åœ¨å¦–Eï¼ˆå¥½åƒè¦ç­‰åˆ°å¤§ä¸€ä¸‹æ‰é€šğŸ˜€ï¼‰ã€‚

å¤§å­¦åæ—¶é—´æ€»å½’æ¯”é«˜ä¸­å¤šä¸€ç‚¹ï¼Œä¸è¿‡ STG å¼ºåº¦åº”è¯¥æ˜¯è¿œä¸å¦‚ä¹‹å‰çš„ã€‚ä»¥å‰åŸºæœ¬æ¯å‘¨ä¼šæ‰“ä¸€æŠŠï¼Œè¿™ä¸ªæ—¶é—´ç°åœ¨å˜æˆäº†ä¸€ä¸ªæœˆã€‚å¤§ä¸€ä¸Šå¿ƒè¡€æ¥æ½®ï¼ˆå¿˜è®°æ˜¯ä¸æ˜¯æœŸä¸­ç»™æˆ‘å¿ƒæ€å¹²å´©äº†ï¼‰æœ‰æ®µæ—¶é—´ç‹‚ç»ƒæ°¸Nï¼Œæ‹¿å•é­”ç†æ²™è¿˜çœŸæ‰“å‡ºäº†ç¬¬ä¸€ä¸ª N ï¼Œä¸è¿‡åæ¥ä¹Ÿæ²¡ä»€ä¹ˆçƒ­æƒ…ï¼Œç›´åˆ°æš‘å‡é‚£ä¼šå¼€è‡ªåŠ¨é›·æ··å…³å†²å…¨Nï¼ˆåæ”¾å¼ƒï¼Œæ˜Ÿè²èˆ¹æ‰‹æ®µæå…¶å‡¶æ®‹ï¼‰ã€‚å¤§ä¸€ä¸Šçš„å¯’å‡å…¶å®æœ‰è·Ÿäººçº¦ç€åšä¸€ä¸ªå°çš„å•å…³ï¼Œç„¶è€Œæˆ‘å½“æ—¶å¤ªé¸½äº†ï¼ŒåŠ ä¸Šå‡ä¹Ÿä¸é•¿ï¼Œæœ€åè¿æ–‡ä»¶å¤¹éƒ½æ²¡å»ºï¼ˆç¬‘ï¼‰ã€‚æœ€è¿‘æƒ³ç€ç¨å¾®ç©ä¸€ç©å§ï¼Œè¿˜èƒ½ç”¨ AI å†™å¼¹å¹•ä»£ç ï¼Œä»Šå¤©ç®—æ˜¯ç»ˆäºåšå‡ºæ¥ä¸€å¼ ç¬¦å¡å§ï¼Œå°±å†™ä¸€ç¯‡çºªå¿µä¸€ä¸‹ã€‚

## Before Reading

{{< ncm id="28234319" >}}

æˆ‘æƒ³ä»¥å‡ é¦–æ­Œä½œä¸ºè‡ªåˆ¶å¼¹å¹•çš„ä¸»é¢˜ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ç«¹ä¹‹èŠ±ã€‚

å¦‚æœä¸çŸ¥é“å‰§æƒ…çš„è¿˜æ˜¯å¾ˆæ¨èå»çœ‹çœ‹åŸç¯‡çš„ã€‚æˆ‘ä¸€ç›´å¾ˆæ¨å´‡ç”¨æœ‰é™çš„ç¯‡å¹…è§¦åŠ¨äººçš„ä½œå“ï¼Œç«¹ä¹‹èŠ±åšåˆ°äº†ã€‚

è™½ç„¶åæ¥å¬åˆ°è¿™é¦–æ­Œå¤šæ˜¯ä»¥äºŒå€é€Ÿçš„å½¢å¼äº†ï¼ˆéš¾è§†ï¼‰ã€‚

## First Spell Card

å…¶å®ä¹‹å‰ï¼ˆ 29 å·ï¼‰ä¸ºäº†ç†Ÿæ‚‰ä¸€ä¸‹ Editor Sharp æ€ä¹ˆæ­é… AI é£Ÿç”¨ï¼Œå·²ç»åšè¿‡ä¸€å¼ ç¬¦å¡äº†ï¼Œä¸è¿‡é‚£ä¸ªçº¯å± AI åˆ›æ„ã€‚

ä¸‹é¢è¿™å¼ ç¬¦å°±æ˜¯ç¬¦å¡ã€Œç«¹ãƒèŠ±ã€ï¼Œæˆ‘çš„æœ€åˆæ„æƒ³æ˜¯è®©ç»¿è‰²ç±³å¼¹æ¨¡æ‹Ÿç«¹å­ï¼Œä»ç‰ˆåº•å‘ä¸Šé•¿ï¼Œæœ€ååœ¨æœ«ç«¯å¼€èŠ±ã€‚æœ€åç«¹å­å¼¹å¹•æ¶ˆå¤±ï¼ŒèŠ±é›¨æ•£è½ã€‚

ç”±äº 1 æœˆ Github Copilot çš„é¢åº¦è¢«æˆ‘åš CPU å’Œæ­ç½‘ç«™çƒ§å®Œäº†ï¼Œåªèƒ½ç”¨ä¸€äº›å¾ˆæçš„æ¨¡å‹ã€‚ç«¹å­çš„å¤„ç†ä¸€ç›´æ„Ÿè§‰ä¸å¤ªåƒï¼Œæœ€åç”¨ä¸¤æ’ç»¿è‰²ç±³å¼¹é”™ä½å¹¶æ’ï¼Œæ„Ÿè§‰å·®ä¸å¤šå°±å¦¥åäº†ã€‚ä¸€å¼€å§‹åšçš„ç«¹èŠ±å¤ªç¨€ç–äº†ï¼Œéƒ½çœ‹ä¸å‡ºèŠ±çš„å½¢çŠ¶ï¼Œåæ¥æƒ³åšæˆå›¢ç°‡çš„å½¢å¼ï¼Œä½†æ˜¯å¼¹å¹•é‡å°±æœ‰äº›ç¦»è°±ï¼Œè€Œä¸”ä¸Šé¿çš„éš¾åº¦æœ‰ç‚¹å°ï¼Œå˜æˆçº¯å§¿åŠ¿äº†ã€‚åæ¥ä¹Ÿç®—æ˜¯å¦¥ååšæˆè¿™æ ·ï¼Œæ˜¯è®©ä¸­å¿ƒç›¸å¯¹å¯†ä¸€ç‚¹ï¼Œä½†æ˜¯åˆå‘å¤–æœ‰ä¸€ç‚¹å»¶ä¼¸ï¼Œä¸è‡³äºç”»é¢å¤ªç©ºã€‚

ä¸‹é¢æ˜¯ AI å†™çš„ä»£ç ï¼Œä¸­é—´è°ƒäº†å¾—æœ‰å‡ åæ¬¡ã€‚æ˜å¤©å°±äºŒæœˆäº†ç­‰æˆ‘æ¢æ¨¡å‹~
```lua
lasttask = task.New(self, function()
    task.MoveTo(0, 160, 60, MOVE_NORMAL)
    
    local rng = Rand()
    local timer = 0

    while true do
        self.x = 20 * sin(timer * 1.0)

        for i = 1, 4 do
            local base_x = -150 + (i - 1) * 100 
            
            task.New(self, function()
                local bamboo_parts = {}     
                local current_flowers = {}  

                local function grow_logic(sx, sy, s_angle, depth, max_j, parts, flowers)
                    local curr_x, curr_y = sx, sy
                    local ang = s_angle
                    
                    for j = 1, max_j do
                        ang = ang + rng:Float(-1.0, 1.0)
                        if ang < 80 then ang = 80 elseif ang > 100 then ang = 100 end
                        
                        local step = 10
                        local next_x = curr_x + step * cos(ang)
                        local next_y = curr_y + step * sin(ang)
                        
                        local b1 = New(_straight, grain_b, COLOR_GREEN, curr_x, curr_y, 0, ang, false, 0, true, true, 0, false, 0, 0, 0, false)
                        local b2 = New(_straight, grain_b, COLOR_GREEN, curr_x + 5*cos(ang), curr_y + 5*sin(ang), 0, ang, false, 0, true, true, 0, false, 0, 0, 0, false)
                        table.insert(parts, b1)
                        table.insert(parts, b2)

                        -- --- ã€æ–°å¢ï¼šç«¹å¶ç”Ÿé•¿é€»è¾‘ã€‘ ---
                        -- ä¸»å¹²æ¯ 6 èŠ‚é•¿å¶ï¼Œä¾§æåœ¨ä¸­é—´é•¿å¶
                        if (depth == 0 and j % 6 == 0 and j < max_j - 5) or (depth > 0 and j == 6) then
                            local leaf_side = (rng:Float(0,1) > 0.5 and 1 or -1)
                            for k = 1, 2 do -- æ¯æ¬¡æˆç°‡é•¿å‡º 2 ç‰‡å¶å­
                                local leaf_ang = ang + leaf_side * rng:Float(40, 70)
                                local leaf = New(_straight, grain_a, COLOR_DEEP_GREEN, curr_x, curr_y, 0, leaf_ang, false, 0, true, true, 0, false, 0, 0, 0, false)
                                table.insert(parts, leaf)
                                leaf_side = leaf_side * -1 -- å·¦å³äº¤é”™æˆ–å¯¹ç§°
                            end
                        end

                        if depth == 0 and j == 26 then
                            local side = (rng:Float(0, 1) > 0.5 and 1 or -1)
                            task.New(self, function()
                                grow_logic(curr_x, curr_y, ang + side * 30, depth + 1, 12, parts, flowers)
                            end)
                            ang = ang - side * 8
                        end

                        -- ã€é«˜å¯†åº¦çº¢è‰²ä¸­å¿ƒèŠ±ç°‡ã€‘
                        if j >= (max_j - 1) then
                            local bloom_intensity = 18 + (j - (max_j - 1)) * 4
                            for n = 1, bloom_intensity do 
                                local raw_r = sqrt(rng:Float(0, 1)) * 35
                                local offset_a = rng:Float(0, 360) 
                                local fx = curr_x + (raw_r * 1.2) * cos(offset_a)
                                local fy = curr_y + (raw_r * 0.8) * sin(offset_a)
                                local f_type = (rng:Float(0, 1) > 0.7) and grain_a or ball_small
                                local f_color = (f_type == grain_a) and COLOR_PURPLE or COLOR_RED
                                local flower = New(_straight, f_type, f_color, fx, fy, 0, rng:Float(0, 360), false, 0, true, true, 0, false, 0, 0, 0, false)
                                table.insert(flowers, flower)
                            end
                        end

                        curr_x, curr_y = next_x, next_y
                        task.Wait(4)
                    end
                end

                grow_logic(base_x, -260, 90, 0, 46, bamboo_parts, current_flowers)

                task.Wait(30) 

                task.New(self, function()
                    for k = 1, #bamboo_parts do
                        if IsValid(bamboo_parts[k]) then Del(bamboo_parts[k]) end
                        if k % 30 == 0 then task.Wait(1) end
                    end
                end)

                task.Wait(40) 

                for _, flower in ipairs(current_flowers) do
                    if IsValid(flower) then
                        task.New(flower, function()
                            local weight = rng:Float(0, 1)
                            local gravity = 0.005 + (weight * 0.015)
                            flower.vx, flower.vy = rng:Float(-0.4, 0.4), -rng:Float(0, 0.2) * weight
                            local wind_sense = (1.2 - weight) * rng:Float(0.02, 0.04)
                            local friction = 0.97 + (weight * 0.02)
                            while IsValid(flower) do
                                flower.vy = flower.vy - gravity
                                flower.vx = (flower.vx + wind_sense * sin(timer * 2.5 + rng:Float(0, 360))) * friction
                                if flower.vy < -3.5 then flower.vy = -3.5 end
                                task.Wait(1)
                            end
                        end)
                    end
                end
            end)
        end

        task.Wait(320) 
        timer = timer + 1
    end
end)
```

é‚£ä¸ªæ³¨é‡Šé‡Œå†™çš„ä»€ä¹ˆç«¹å¶ï¼Œæˆ‘çœ‹ä¸Šå»æ›´åƒæ˜¯ç«¹èŠ‚ï¼Œä¹Ÿå°±å¹²è„†åšæˆæ·±ç»¿è‰²äº†ã€‚

## Final Scene

ç›´æ¥æ”¾Bç«™é“¾æ¥äº†ï¼Œ[ä¼ é€é—¨](https://www.bilibili.com/video/BV1DU61BmEy2)ã€‚

é¿å¼¹çš„åšæ³•æ˜¯æ‰¾åˆ°äº†çµæ¢¦æœºä½“çš„ `.lua` æºç ï¼Œåœ¨é‡Œé¢æŠŠçµæ¢¦çš„ `frame()` å‡½æ•°æ¢æ‰äº†ã€‚å¤§è‡´é€»è¾‘æ˜¯æ¯ä¸ªå¼¹å¹•ç»™ä¸€å®šæ–¥åŠ›ï¼Œè¿˜è¦æ³¨æ„æŠŠè‡ªæœºæ‹‰å›ç‰ˆåº•ä¸­éƒ¨ï¼Œä¸ç„¶ä¼šå¾ˆå®¹æ˜“é£˜åˆ°è§’è½è¢«å°æ­»ã€‚ 

ä¹‹åä¼šç»§ç»­åšä¸€äº›ç¬¦å¡ï¼Œå†çœ‹çœ‹èƒ½ä¸èƒ½ä¼˜åŒ–è¿™ä¸ªé¿å¼¹é€»è¾‘ï¼Œæˆ–è®¸çœŸè¦åšæˆä¸€ä¸ªå°é¡¹ç›®å‘¢...

## Something Unrelated

29 å·ä¸œæ–¹è¿·å®« 3 å‡ºäº†ï¼Œå¬è¯´æ±‰åŒ–å¯èƒ½è¿™ä¸¤å¤©èƒ½å¥½ï¼Œåé¢å¿…é¡»è¦å°å°å’¸æ·¡äº†ã€‚

æœ€è¿‘ç¡å¾—å¥½æ™šï¼ˆèµ·å¾—ä¹Ÿå¥½æ™šï¼‰ï¼Œæ„Ÿè§‰ç²¾ç¥æœ‰äº›èé¡å•Šï¼Œè°ƒä½œæ¯å§è°ƒä½œæ¯ã€‚