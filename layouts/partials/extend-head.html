<!-- Prism.js for code highlighting -->
<link rel="stylesheet" href="/css/prism.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"></script>
<link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "2375", right: "2375", display: true},
                {left: "$", right: "$", display: false}
            ],
            throwOnError : false
        });
    });
</script>

<style>
    :root {
        --article-max-width: min(75ch, 100%);
    }

    @media (min-width: 1024px) {
        :root {
            --article-max-width: min(90ch, 100%);
        }

        /* 减少右边距，让侧边栏更靠右 */
        body {
            padding-right: 0rem !important;
        }
    }

    @media (min-width: 1280px) {
        body {
            padding-right: 0rem !important;
        }
    }

    /* 文章与侧边栏布局 */
    .article-with-sidebar {
        display: flex;
        flex-direction: column;
        gap: 3rem;
    }

    @media (min-width: 1024px) {
        .article-with-sidebar {
            flex-direction: row;
        }
    }

    .article-sidebar {
        order: -1; /* 移动端时显示在顶部 */
    }

    @media (min-width: 1024px) {
        .article-sidebar {
            order: 1; /* 大屏幕时显示在右侧 */
            width: 230px;
            min-width: 230px;
        }
    }

    .sidebar-sticky {
        position: relative;
    }

    @media (min-width: 1024px) {
        .sidebar-sticky {
            position: sticky;
            top: 6rem;
        }
    }

    article #single_header,
    article section.prose,
    article .article-content {
        max-width: var(--article-max-width);
    }

    article section.prose,
    article .article-content {
        width: 100%;
    }

    #search-button,
    #search-button-mobile {
        display: none !important;
    }

    .aplayer.aplayer-fixed {
        left: auto !important;
        right: 1.5rem !important;
        bottom: 1.5rem;
        width: 320px !important;
        max-width: calc(100vw - 2rem);
        border-radius: 0.75rem;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.4);
        overflow: hidden;
    }

    .aplayer.aplayer-fixed .aplayer-body {
        border-radius: 0.75rem;
    }

    .aplayer .aplayer-icon-menu,
    .aplayer .aplayer-list {
        display: none !important;
    }

    .aplayer .aplayer-title,
    .aplayer .aplayer-author {
        color: #111111 !important;
        text-shadow: none;
        font-family: inherit;
    }

    .aplayer .aplayer-title {
        font-weight: normal;
    }

    .aplayer .aplayer-author {
        opacity: 0.8;
        font-size: 0.9rem;
    }

    .aplayer .aplayer-lrc,
    .aplayer .aplayer-lrc-wrap {
        display: none !important;
    }

    @media (max-width: 768px) {
        .aplayer.aplayer-fixed {
            left: 0.5rem !important;
            right: 0.5rem !important;
            width: calc(100vw - 1rem) !important;
        }
    }

    /* Prism.js 代码块样式 */
    pre[class*="language-"],
    pre.line-numbers {
        margin: 1em 0;
        border-radius: 0.5rem;
        overflow: auto;
        background: #2d2d2d !important;
    }

    /* 确保代码块在文章中正常显示 */
    article pre[class*="language-"],
    .prose pre[class*="language-"] {
        max-width: 100%;
    }

    /* 行号样式优化 */
    pre[class*="language-"].line-numbers {
        padding-left: 3.8em;
    }

    .line-numbers .line-numbers-rows {
        border-right-color: rgba(255, 255, 255, 0.1);
    }

    /* 复制按钮样式优化 */
    div.code-toolbar > .toolbar {
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    div.code-toolbar:hover > .toolbar {
        opacity: 1;
    }

    div.code-toolbar > .toolbar > .toolbar-item > button,
    div.code-toolbar > .toolbar > .toolbar-item > span {
        background: rgba(255, 255, 255, 0.2);
        color: #ccc;
        padding: 0.25em 0.5em;
        font-size: 0.75em;
        border-radius: 0.25rem;
    }

    div.code-toolbar > .toolbar > .toolbar-item > button:hover {
        background: rgba(255, 255, 255, 0.3);
        color: #fff;
    }

    /* 暗色模式适配 */
    .dark pre[class*="language-"] {
        background: #1e1e1e !important;
    }

    /* Prism token 颜色 - 确保可见 */
    code[class*="language-"],
    pre[class*="language-"] {
        color: #ccc;
    }

    /* 侧边栏样式 */
    .sidebar-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .sidebar-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .dark .sidebar-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* 侧边栏社交图标样式 */
    .sidebar-card a svg {
        width: 1.25rem;
        height: 1.25rem;
    }

    /* 文章标题截断 */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* 移动端侧边栏样式 - 横向排列 */
    @media (max-width: 1023px) {
        .article-sidebar {
            display: flex;
            flex-direction: row;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .article-sidebar .sidebar-card {
            flex-shrink: 0;
            width: 280px;
        }

        .sidebar-sticky {
            display: contents;
        }

        .sidebar-sticky > * {
            flex-shrink: 0;
        }
    }

    /* 大屏幕侧边栏 */
    @media (min-width: 1024px) {
        article {
            max-width: none;
        }
    }
</style>

<!-- Prism.js for code highlighting with line numbers and copy button -->
<script src="/js/prism.js"></script>
<script>
    // 确保 Prism 高亮所有代码块
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof Prism !== 'undefined') {
            Prism.highlightAll();
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 搜索按钮
        var searchLinks = document.querySelectorAll('a[href="#search"]');
        if (searchLinks.length) {
            var openSearchModal = function () {
                var trigger = document.getElementById("search-button") || document.getElementById("search-button-mobile");
                if (trigger) {
                    trigger.click();
                    var queryInput = document.getElementById("search-query");
                    if (queryInput) {
                        queryInput.focus();
                    }
                }
            };
            searchLinks.forEach(function (link) {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    openSearchModal();
                });
            });
        }

        // Music 按钮
        var musicLinks = document.querySelectorAll('a[href="#music"]');
        if (musicLinks.length) {
            var player = document.querySelector('.aplayer.no-destroy');
            var aplayer = null;
            function showPlayerAndPlayRandom() {
                if (!player) return;
                player.style.display = '';
                if (!window.aplayers || !window.aplayers.length) return;
                aplayer = window.aplayers[0];
                // 随机选一首
                var audios = aplayer.list && aplayer.list.audios;
                if (audios && audios.length) {
                    var idx = Math.floor(Math.random() * audios.length);
                    aplayer.list.switch(idx);
                    aplayer.seek(0);
                    aplayer.play();
                }
            }
            musicLinks.forEach(function (link) {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    showPlayerAndPlayRandom();
                });
            });
            // 默认隐藏播放器
            if (player) player.style.display = 'none';
        }
    });
</script>

